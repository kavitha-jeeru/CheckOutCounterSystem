<!DOCTYPE html>
<html>
<head>
    <title>Checkout Counter System</title>

    <style>
        body {
            margin: 0;
            font-family: Arial;
            background: #f2f2f2;
        }

        .header {
            background: #2d3436;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 22px;
        }

        .container {
            width: 90%;
            margin: auto;
            margin-top: 20px;
        }

        .section {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .customer-row,
        .menu-header,
        .menu-row,
        .summary-header,
        .summary-row {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 6px;
        }

        .menu-header,
        .summary-header {
            font-weight: bold;
            border-bottom: 2px solid #2d3436;
        }

        .item {
            width: 140px;
        }

        .price {
            width: 70px;
        }

        .qty {
            width: 90px;
        }

        .available {
            width: 80px;
        }

        .summary-header span,
        .summary-row span {
            flex: 1;
            white-space: normal;
            word-break: break-word;
            text-align: center;
        }

        button {
            background: #0984e3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        input {
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .counters {
            display: flex;
            gap: 20px;
        }

        .counter {
            width: 30%;
            background: #f1f2f6;
            padding: 10px;
            border-radius: 8px;
        }

        .counter h3 {
            text-align: center;
            background: #2d3436;
            color: white;
            padding: 6px;
            border-radius: 5px;
        }

        .counter ul {
            list-style: decimal;
            padding-left: 20px;
        }

        .msg {
            color: red;
            font-weight: bold;
        }

        .msg-success {
            color: green;
            font-weight: bold;
        }

        #adminBtn {
            position: fixed;
            top: 10px;
            right: 10px;
        }

        #showSummaryBtn {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="header">Checkout Counter System</div>
<button id="adminBtn">Admin</button>

<div class="container" id="mainPage">

    <div class="section">
        <h2>Customer Details</h2>
        <div class="customer-row">
            <span>Name :</span>
            <input type="text" id="custName">
            <span>Phone :</span>
            <input type="text" id="custPhone">
            <button id="goMenu">Go to Menu</button>
        </div>
        <p id="msgCustomer" class="msg"></p>
    </div>

    <div class="section" id="menuSection" style="display:none;">
        <h2>Menu</h2>
        <div class="menu-header">
            <span class="item">Item</span>
            <span class="price">Price</span>
            <span class="available">Available</span>
            <span class="qty">Buy Qty</span>
        </div>
        <div id="menuBody"></div>
        <br>
        <button id="calcBill">Calculate Bill</button>
        <p><b>Total:</b> Rs. <span id="total"></span></p>
        <p><b>After Discount:</b> Rs. <span id="finalTotal"></span></p>
        <button id="addCustomerBtn">Add to Counter</button>
        <p id="msgMenu" class="msg"></p>
    </div>

    <div class="section counters" id="counterArea"></div>

    <div class="section" id="summarySectionWrapper">
        <button id="showSummaryBtn">Show Summary</button>
        <div id="summarySection" style="display:none; margin-top:10px;">
            <div class="summary-header">
                <span>Name</span>
                <span>Items</span>
                <span>Type</span>
                <span>Bill</span>
                <span>Discount</span>
                <span>Final Bill</span>
                <span>Counter</span>
            </div>
            <div id="summaryBody"></div>
        </div>
    </div>

</div>

<div class="section" id="adminLogin" style="display:none;">
    <h2>Admin Login</h2>
    Username : <input type="text" id="adminUser"><br><br>
    Password : <input type="password" id="adminPass"><br><br>
    <button id="loginAdminBtn">Login</button>
    <p id="adminLoginMsg" class="msg"></p>
</div>

<div class="section" id="adminPage" style="display:none;">
    <h2>Admin Page</h2>
    <div class="menu-header">
        <span class="item">Item</span>
        <span class="price">Set Price</span>
    </div>
    <div id="adminMenu"></div>
    <br>
    <button id="updatePricesBtn">Update Prices</button>
    <button id="logoutAdminBtn">Logout</button>
    <p id="adminPageMsg" class="msg-success"></p>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
class Customer {
    constructor(name, phone) {
        this.name = name;
        this.phone = phone;
        this.cart = [];
    }

    addItem(item, qty) {
        if (qty > 0) {
            this.cart.push({
            item: item, qty: qty 
           });
        }
    }

    calculateTotal() {
        let sum = 0;
        for (let i = 0; i < this.cart.length; i++) {
            sum += this.cart[i].item.price * this.cart[i].qty;
        }
        return sum;
    }

    listItems() {
        let r = "";
        for (let i = 0; i < this.cart.length; i++) {
            r += this.cart[i].item.name + "(" + this.cart[i].qty + ")";
            if (i < this.cart.length - 1) {
                r += ",";
            }
        }
        return r;
    }
}

class Counter {
    constructor(id, max = 3) {
        this.id = id;
        this.queue = [];
        this.max = max;
    }

    addCustomer(c) {
        if (this.queue.length < this.max) {
            this.queue.push(c);
            return true;
        }
        return false;
    }

    removeCustomer() {
        return this.queue.shift();
    }

    getQueueNames() {
        let names = [];
        for (let i = 0; i < this.queue.length; i++) {
            names.push(this.queue[i].name);
        }
        return names;
    }
}

class Checkout {
    buildMenu(items) {
        let display = "";
        for (let i = 0; i < items.length; i++) {
            display +=
                "<div class='menu-row'>" +
                    "<span class='item'>" + items[i].name + "</span>" +
                    "<span class='price'>" + items[i].price + "</span>" +
                    "<span class='available'>" + items[i].qty + "</span>" +
                    "<input type='number' class='qty' id='q" + i + "'>" +
                "</div>";
        }
        $("#menuBody").html(display);
    }

    buildCounters(counters) {
        let display = "";
        for (let i = 0; i < counters.length; i++) {
            display +=
                "<div class='counter'>" +
                    "<h3>Counter " + counters[i].id + "</h3>" +
                    "<ul id='queue" + counters[i].id + "'></ul>" +
                    "<button onclick='billingDone(" + counters[i].id + ")'>Billing Done</button>" +
                "</div>";
        }
        $("#counterArea").html(display);
    }

    updateQueues(counters) {
        for (let i = 0; i < counters.length; i++) {
            let ul = $("#queue" + counters[i].id);
            ul.html("");
            let q = counters[i].queue;
            for (let j = 0; j < q.length; j++) {
                ul.append("<li>" + q[j].name + "</li>");
            }
        }
    }
}

let items = [
    { name: "Apple", price: 50, qty: 100 },
    { name: "Orange", price: 30, qty: 100 },
    { name: "Carrot", price: 20, qty: 100 },
    { name: "Beetroot", price: 25, qty: 100 },
    { name: "Chocolate", price: 80, qty: 100 },
    { name: "Icecream", price: 60, qty: 100 }
];

let counters = [new Counter(1), new Counter(2), new Counter(3)];
let checkout = new Checkout();
checkout.buildMenu(items);
checkout.buildCounters(counters);

let currentCustomer = null;
let customerHistory = [];
let allBills = [];

let adminUser = "admin";
let adminPass = "1234";

$("#goMenu").click(function() {
    let n = $("#custName").val();
    let p = $("#custPhone").val();

    if (!n || !p) {
        $("#msgCustomer").text("Enter customer details");
        return;
    }

    $("#msgCustomer").text("");
    currentCustomer = new Customer(n, p);
    $("#menuSection").show();
});

$("#calcBill").click(function() {
    currentCustomer.cart = [];
    $("#msgMenu").text("");

    for (let i = 0; i < items.length; i++) {
        let qty = $("#q" + i).val() || 0;
        if (qty > items[i].qty) {
            $("#msgMenu").text("Out of stock: " + items[i].name);
            return;
        }
        currentCustomer.addItem(items[i], qty);
    }

    let total = currentCustomer.calculateTotal();
    $("#total").text(total);
    $("#finalTotal").text(total);
});

$("#addCustomerBtn").click(function() {
    let min = counters[0];
    for (let i = 1; i < counters.length; i++) {
        if (counters[i].queue.length < min.queue.length) {
            min = counters[i];
        }
    }

    if (!min.addCustomer(currentCustomer)) {
        $("#msgMenu").text("All counters full");
        return;
    }

    for (let i = 0; i < currentCustomer.cart.length; i++) {
        currentCustomer.cart[i].item.qty -= currentCustomer.cart[i].qty;
    }

    checkout.buildMenu(items);
    checkout.updateQueues(counters);

    currentCustomer = null;
    $("#menuSection").hide();
    $("#custName").val("");
    $("#custPhone").val("");
    $("#total").text("");
    $("#finalTotal").text("");

    for (let i = 0; i < items.length; i++) {
        $("#q" + i).val("");
    }
});

$("#showSummaryBtn").click(function() {
    $("#summarySection").show();
});

$("#adminBtn").click(function() {
    $("#mainPage").hide();
    $("#adminLogin").show();
});

$("#loginAdminBtn").click(function() {
    if ($("#adminUser").val() === adminUser && $("#adminPass").val() === adminPass) {
        $("#adminLogin").hide();
        let display = "";
        for (let i = 0; i < items.length; i++) {
            display +=
                "<div class='menu-row'>" +
                    "<span class='item'>" + items[i].name + "</span>" +
                    "<input type='number' class='price' id='p" + i + "' value='" + items[i].price + "'>" +
                "</div>";
        }
        $("#adminMenu").html(display);
        $("#adminPage").show();
        $("#adminLoginMsg").text("");
    } else {
        $("#adminLoginMsg").text("Invalid username/password");
    }
});

$("#updatePricesBtn").click(function() {
    for (let i = 0; i < items.length; i++) {
        items[i].price = Number($("#p" + i).val());
    }
    checkout.buildMenu(items);
    $("#adminPageMsg").text("Prices are updated").css("color", "green");
});

$("#logoutAdminBtn").click(function() {
    $("#adminPage").hide();
    $("#mainPage").show();
    $("#adminUser").val("");
    $("#adminPass").val("");
    $("#adminLoginMsg").text("");
    $("#adminPageMsg").text("");
});

function billingDone(id) {
    let counter = counters[id - 1];
    let cust = counter.removeCustomer();

    if (!cust) {
        return;
    }

    let bill = cust.calculateTotal();
    allBills.push(bill);

    let sum = 0;
    for (let i = 0; i < allBills.length; i++) {
        sum += allBills[i];
    }

    let avg = sum / allBills.length;

    let existing = null;
    for (let i = 0; i < customerHistory.length; i++) {
        if (customerHistory[i].name === cust.name && customerHistory[i].phone === cust.phone) {
            existing = customerHistory[i];
            break;
        }
    }

    let type = "Regular";

    if (!existing) {
        customerHistory.push({ 
             name: cust.name,
             phone: cust.phone, 
             type: "Regular" });
    } else {
        if (bill > avg) {
            existing.type = "VIP";
            type = "VIP";
        } else {
            existing.type = "Regular";
            type = "Regular";
        }
    }

    let discount = 0;
    let finalBill = bill;
    if (type === "VIP") {
        discount = bill * 10 / 100;
        finalBill = bill - discount;
    }

    let display =
        "<div class='summary-row'>" +
            "<span>" + cust.name + "</span>" +
            "<span>" + cust.listItems() + "</span>" +
            "<span>" + type + "</span>" +
            "<span>" + bill + "</span>" +
            "<span>" + discount + "</span>" +
            "<span>" + finalBill + "</span>" +
            "<span>" + counter.id + "</span>" +
        "</div>";

    $("#summaryBody").append(display);

    for (let i = 0; i < counters.length; i++) {
        let ul = $("#queue" + counters[i].id);
        ul.html("");
        let q = counters[i].queue;
        for (let j = 0; j < q.length; j++) {
            ul.append("<li>" + q[j].name + "</li>");
        }
    }
}
</script>

</body>
</html>
